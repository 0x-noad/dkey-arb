
        detailsObj = {
            scheme: [
                [
                "<span class=\"green flush-left underlined\">TECHNICAL DETAILS [1/4]:  THE ENCRYPTION SCHEME</span>",
                "<br>",
                "At the foundation of the protocol is the encryption scheme. It is implemented via the zero-knowledge proof circuit, and its",
                "associated SMART CONTRACT & LIBRARY functions.",
                "<br>",
                "The scheme utilizes the following cryptographic primitives...",
                ">  <a href=\"scheme-1\" class=\"protocol-link no-click\">SYMMETRIC ENCRYPTION</a> ",
                ">  <a href=\"scheme-2\" class=\"protocol-link no-click\">ELLIPTIC CURVE CRYPTOGRAPHY</a> ",
                ">  <a href=\"scheme-3\" class=\"protocol-link no-click\">HASH-BASED COMMITMENT</a> ",
                ">  <a href=\"scheme-4\" class=\"protocol-link no-click\">ZERO-KNOWLEDGE PROOF</a> ",
                "<br>",
                "...to verifiably make the statement:",
                "<br>",
                "   <span style=\"font-style: italic;\">\"This DKEY is a valid ciphertext resulting from the ElGamal encryption of a committed point for a given public key.\"</span>",
                "<br>",
                "<br>",
                "Use the <span class=\"command\">[UP]</span> and <span class=\"command\">[DOWN]</span> arrows to navigate. Hit <span class=\"command\">[ENTER]</span> to continue.",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">SYMMETRIC ENCRYPTION:</span>",
                "•  A symmetric encryption scheme uses the same secret key for encryption and decryption",
                "•  <a href=\"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard\" target=\"_blank\" rel=\"noopener noreferrer\">Advanced Encryption Standard (AES)</a> is a commonly used form of symmetric encryption",
                "<br>",
                "<br>",
                "When ALICE encrypts her file, she uses 256-bit AES. The key she uses to encrypt her file is what she will later use to create DKEYs. ",
                "The fixed key size means that creating DKEYs for many BOBs is not too computationally intensive, regardless of the original file size.",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">ELLIPTIC CURVE CRYPTOGRAPHY:</span>",
                "•  Elliptic Curve Cryptography (ECC) is a type of <a href=\"https://www.cloudflare.com/en-ca/learning/ssl/how-does-public-key-encryption-work/\" target=\"_blank\" rel=\"noopener noreferrer\">public-key cryptography</a> that uses elliptic curves over finite fields ",
                "•  <a href=\"https://andrea.corbellini.name/2023/01/02/ec-encryption/\" target=\"_blank\" rel=\"noopener noreferrer\">Elliptic Curve ElGamal</a> is a commonly used encryption scheme over elliptic curves",
                "•  BN254 is a pairing-friendly elliptic curve, and a <a href=\"https://hackmd.io/@jpw/bn254\" target=\"_blank\" rel=\"noopener noreferrer\">practical choice for use in verifying on-chain zkSNARKs</a>",
                "<br>",
                "<br>",
                "The AES key ALICE uses to encrypt her file is a randomly generated point on the BN254 elliptic curve. This allows ALICE to ElGamal ",
                "encrypt the point for BOB's public key. A DKEY is just the resulting ciphertext of this ElGamal encryption. Due to BN254's",
                "pairing-friendliness, the validity of the ciphertext (DKEY) can be cheaply verified on-chain using a zero-knowledge proof.",
                "<br>",
                "If BOB's BID is responded to with a valid DKEY, he'll be able to ElGamal decrypt it, revealing the original BN254 point (AES key).",
                "He can then use the AES key to decrypt ALICE's file.",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">HASH-BASED COMMITMENT:</span>",
                "•  <a href=\"https://en.wikipedia.org/wiki/Commitment_scheme\" target=\"_blank\" rel=\"noopener noreferrer\">Commitment schemes</a> are a type of cryptographic primitive that allows one to commit to a value without revealing it",
                "•  <a href=\"https://www.poseidon-hash.info/\" target=\"_blank\" rel=\"noopener noreferrer\">Poseidon</a> is a one-way hash function designed for use with zero-knowledge proof systems",
                "<br>",
                "<br>",
                "When ALICE creates her LISTING, she Poseidon hashes the BN254 point (AES key) and stores the hash on-chain. This commitment",
                "ensures that the same BN254 point is used in the creation of all DKEYs for that LISTING.",
                "<br>",
                "When ALICE creates a DKEY for BOB, part of the on-chain validation of the ciphertext is a check that the Poseidon hash",
                "of the plaintext she used matches the commitment stored in the LISTING. Due to the zk-friendliness of Poseidon, this check",
                "can be done cheaply on-chain via a zkSNARK.",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">ZERO-KNOWLEDGE PROOF:</span>",
                "•  <a href=\"https://en.wikipedia.org/wiki/Zero-knowledge_proof\" target=\"_blank\" rel=\"noopener noreferrer\">Zero-knowledge proofs</a> make it possible to prove a statement while only revealing partial information about the statement",
                "•  <a href=\"https://eprint.iacr.org/2016/260\" target=\"_blank\" rel=\"noopener noreferrer\">zkSNARK (Groth16)</a> is a commonly used zero-knowledge proof system in blockchain applications",
                "•  <a href=\"https://docs.circom.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Circom</a> is a popular library for implementing zero-knowledge proof circuits",
                "<br>",
                "<br>",
                "When a DKEY is created for a bidder, an accompanying zkSNARK validity proof is created. The proof says the following:",
                "1.     The BN254 point was ElGamal encrypted correctly for the given public key, and",
                "2.     The BN254 point evaluates to the given Poseidon hash",
                "<br>",
                "The resulting proof (& public signals) are validated by the Verifier.sol contract. It takes...",
                "-     The proof                                <span class=\"codeblock\">pA, pB, pC</span>",
                "-     The ciphertext (DKEY)                    <span class=\"codeblock\">_pubSignals[0], _pubSignals[1], _pubSignals[2], _pubSignals[3]</span>",
                "-     The Poseidon hash of the BN254 point     <span class=\"codeblock\">_pubSignals[4]</span>",
                "-     The public key of the bidder             <span class=\"codeblock\">_pubSignals[5], _pubSignals[6]</span>",
                "...and returns true if the DKEY is valid.",
                "<br>",
                "<br>",
                "All together, the proof system allows us to enforce certain important properties of the scheme:",
                "1.    Only by providing a valid DKEY can a seller receive the bidder's funds",
                "2.    Every DKEY created for a given LISTING is derived from the same BN254 point (AES key)",
                "3.    The original BN254 point is only ever revealed to DKEY owners",
                "<br>",
                "For the scheme to be 'multi-hop', anyone with the original BN254 point must be able to satisfy the on-chain zero-knowledge proof ",
                "verification. Therefore, to limit who can fill a bid, we track who is a DKEY owner on-chain. This is done by storing each DKEY",
                "owner's public key and address in the smart contract.",
                "<br>",
                ],
            ],

            sc: [
                [
                "<span class=\"green flush-left underlined\">TECHNICAL DETAILS [2/4]:  THE SMART CONTRACT</span>",
                "<br>",
                "<span class=\"index\">DKeyStore.sol</span> implements the application logic for the protocol. It stores all the LISTING & BID data, and governs the buying & selling of DKEYs.",
                "<br>",
                "The smart contract defines the following...",
                "<br>",
                "FUNCTIONS:                       EVENTS:                     STRUCTS:                     MAPPINGS:",
                ">  <a href=\"sc-1\" class=\"protocol-link no-click\">createListing()</a>               >  <a href=\"sc-9\" class=\"protocol-link no-click\">ListingCreated</a>           >  <a href=\"sc-15\" class=\"protocol-link no-click\">ListingDetails</a>            >  <a href=\"sc-18\" class=\"protocol-link no-click\">allListings</a>",
                ">  <a href=\"sc-2\" class=\"protocol-link no-click\">getListingDetails()</a>           >  <a href=\"sc-10\" class=\"protocol-link no-click\">BidReceived</a>              >  <a href=\"sc-16\" class=\"protocol-link no-click\">Listing</a>                   >  <a href=\"sc-19\" class=\"protocol-link no-click\">xAndYToBid</a>",
                ">  <a href=\"sc-3\" class=\"protocol-link no-click\">makeBid()</a>                     >  <a href=\"sc-11\" class=\"protocol-link no-click\">BidUpdated</a>               >  <a href=\"sc-17\" class=\"protocol-link no-click\">Bid</a>",
                ">  <a href=\"sc-4\" class=\"protocol-link no-click\">updateBid()</a>                   >  <a href=\"sc-12\" class=\"protocol-link no-click\">BidReclaimed</a>",
                ">  <a href=\"sc-5\" class=\"protocol-link no-click\">reclaimBid()</a>                  >  <a href=\"sc-13\" class=\"protocol-link no-click\">DkeyProvided</a>",
                ">  <a href=\"sc-6\" class=\"protocol-link no-click\">getBidDetails()</a>               >  <a href=\"sc-14\" class=\"protocol-link no-click\">DkeysCanBeSold</a>",
                ">  <a href=\"sc-7\" class=\"protocol-link no-click\">fillBid()</a> ",
                ">  <a href=\"sc-8\" class=\"protocol-link no-click\">sellDkey()</a> ",
                "<br>",
                "Use the <span class=\"command\">[UP]</span> and <span class=\"command\">[DOWN]</span> arrows to navigate. Hit <span class=\"command\">[BACKSPACE]</span> to go back. Hit <span class=\"command\">[ENTER]</span> to continue.",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">function createListing(bytes calldata _ipfsCid, uint16 _howManyDKeysForSale, uint8 _royaltyPercentage, uint _poseidonHashedSecretKey) external {         </span>",
                "<span class=\"codeblock\">        // 1. requires that a listing does not already exist at allListings[_ipfsCid]                                                                     </span>",
                "<span class=\"codeblock\">        // 2. requires that the royalty percentage is between 1% and 99%                                                                                 </span>",
                "<span class=\"codeblock\">        // 3. creates a new listing, with the given parameters:                                                                                           </span>",
                "<span class=\"codeblock\">        //     newListing.details.howManyDKeysForSale = _howManyDKeysForSale;                                                                             </span>",
                "<span class=\"codeblock\">        //     newListing.details.royaltyPercentage = _royaltyPercentage;                                                                                 </span>",
                "<span class=\"codeblock\">        //     newListing.poseidonHashedSecretKey = _poseidonHashedSecretKey;                                                                             </span>",
                "<span class=\"codeblock\">        //     newListing.details.listingOwnerAddress = payable(msg.sender);                                                                             </span>",
                "<span class=\"codeblock\">        // 4. emits ListingCreated(_ipfsCid, _royaltyPercentage, _howManyDKeysForSale);                                                                   </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                     </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">function getListingDetails(bytes calldata _ipfsCid) external view returns (ListingDetails memory) {                                                          </span>",
                "<span class=\"codeblock\">        // 1. grabs the listing details from allListings[_ipfsCid]                                                                                           </span>",
                "<span class=\"codeblock\">        // 2. returns the listing details                                                                                                                        </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                        </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">function makeBid(bytes calldata _ipfsCid, uint[2] calldata _bidderPubKey) external payable {                                                                 </span>",
                "<span class=\"codeblock\">        // 1. grabs the listing details                                                                                                                      </span>",
                "<span class=\"codeblock\">        // 2. requires that the listing exists (i.e.: thisListing.details.listingOwnerAddress != address(0))                                                 </span>",
                "<span class=\"codeblock\">        // 3. requires that a bid does not already exist for the bidder's public key                                                                         </span>",
                "<span class=\"codeblock\">        //    (i.e.: thisListing.xAndYToBid[_bidderPubKey[0]][_bidderPubKey[1]].amount == 0)                                                                                       </span>",
                "<span class=\"codeblock\">        // 4. requires that the bid amount is valid (i.e.: msg.value != type(uint96).max || msg.value != 0)                                                  </span>",
                "<span class=\"codeblock\">        // 5. creates a new bid                                                                                                                              </span>",
                "<span class=\"codeblock\">        // 6. increments the bid counter                                                                                                                     </span>",
                "<span class=\"codeblock\">        // 7. emits BidReceived(_ipfsCid, thisListing.details.bidCounter, _bidderPubKey, msg.value)                                                          </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                        </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">function updateBid(bytes calldata _ipfsCid, uint[2] calldata _bidderPubKey) external payable {                                                                              </span>",
                "<span class=\"codeblock\">        // 1. grabs the listing details                                                                                                                          </span>",
                "<span class=\"codeblock\">        // 2. grabs the bid details                                                                                                                              </span>",
                "<span class=\"codeblock\">        // 3. requires that msg.sender is the bid owner (i.e.: thisListing.xAndYToBid[_bidderPubKey[0]][_bidderPubKey[1]].ethAddress == msg.sender)                                      </span>",
                "<span class=\"codeblock\">        // 4. requires that the bid is open                                                                                                                      </span>",
                "<span class=\"codeblock\">        //    (i.e.: thisListing.xAndYToBid[_bidderPubKey[0]][_bidderPubKey[1]].amount != type(uint96).max || thisListing.xAndYToBid[_bidderPubKey[0]][_bidderPubKey[1]].amount != 0)                            </span>",
                "<span class=\"codeblock\">        // 5. requires that the bid amount is valid (i.e.: msg.value != type(uint96).max || msg.value != 0)                                                      </span>",
                "<span class=\"codeblock\">        // 6. updates the bid amount                                                                                                                             </span>",
                "<span class=\"codeblock\">        // 7. emits BidUpdated(_ipfsCid, _bidderPubKeyX, updatedBidAmount)                                                                                       </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                            </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">function reclaimBid(bytes calldata _ipfsCid, uint[2] calldata _bidderPubKey) external payable {                                                                             </span>",
                "<span class=\"codeblock\">        // 1. grabs the listing details                                                                                                                          </span>",
                "<span class=\"codeblock\">        // 2. grabs the bid details                                                                                                                              </span>",
                "<span class=\"codeblock\">        // 3. requires that msg.sender is the bid owner (i.e.: thisListing.xAndYToBid[_bidderPubKey[0]][_bidderPubKey[1]].ethAddress == msg.sender)                                          </span>",
                "<span class=\"codeblock\">        // 4. requires that the bid is open                                                                                                                      </span>",
                "<span class=\"codeblock\">        //    (i.e.: thisListing.xAndYToBid[_bidderPubKey[0]][_bidderPubKey[1]].amount != type(uint96).max || thisListing.xAndYToBid[_bidderPubKey[0]][_bidderPubKey[1]].amount != 0)                            </span>",
                "<span class=\"codeblock\">        // 5. shows that the reclaiming bidder no longer owns a dkey (i.e.: delete thisListing.xAndYToBid[_bidderPubKey[0]][_bidderPubKey[1]])                                            </span>",
                "<span class=\"codeblock\">        // 6. returns the bid amount to the bidder                                                                                                               </span>",
                "<span class=\"codeblock\">        // 7. emits BidReclaimed(_ipfsCid, _bidderPubKey)                                                                                                       </span>",
                "<span class=\"codeblock\">        // 8. decrements details.bidCounter                                                                                                                      </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                            </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">function getBidDetails(bytes calldata _ipfsCid, uint _bidderPubKeyX) external view returns (address payable ethAddress, uint96 amount) {                         </span>",
                "<span class=\"codeblock\">        // 1. grabs the listing details                                                                                                                          </span>",
                "<span class=\"codeblock\">        // 2. grabs the bid details                                                                                                                              </span>",
                "<span class=\"codeblock\">        // 3. returns bid.ethAddress and bid.amount                                                                                                              </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                            </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">function fillBid(bytes calldata _ipfsCid, uint[2] calldata _pA, uint[2][2] calldata _pB, uint[2] calldata _pC, uint[7] calldata _pubSignals) external {          </span>",
                "<span class=\"codeblock\">        // 1. grabs the listing details                                                                                                                          </span>",
                "<span class=\"codeblock\">        // 2. requires that msg.sender is the listing owner (i.e.: thisListing.details.listingOwnerAddress == msg.sender)                                            </span>",
                "<span class=\"codeblock\">        // 3. requires that the listing owner has not yet sold the max number of dkeys for this listing                                                           </span>",
                "<span class=\"codeblock\">        // 4. requires that _pubSignals[4] matches the poseidonHashedSecretKey for this listing                                                                  </span>",
                "<span class=\"codeblock\">        // 5. requires that thisListing.xAndYToBid[_pubSignals[5]][_pubSignals[6]] is an open bid                                                                                   </span>",
                "<span class=\"codeblock\">        // 6. requires that zkVerifier.verifyProof(_pA, _pB, _pC, _pubSignals) returns true                                                                      </span>",
                "<span class=\"codeblock\">        // 7. emits DKeyProvided(_ipfsCid, _pubSignals[5], [_pubSignals[0], _pubSignals[1], _pubSignals[2], _pubSignals[3]])                                    </span>",
                "<span class=\"codeblock\">        // 8. shows that the bidder now owns a dkey (i.e.: thisListing.xAndYToBid[_pubSignals[5]][_pubSignals[6]].amount = type(uint96).max)                                            </span>",
                "<span class=\"codeblock\">        // 9. transfers 99% of the bid amount to the listing owner                                                                                                   </span>",
                "<span class=\"codeblock\">        // 10. transfers 1% of the bid amount to the DividendPayingToken.sol contract                                                                            </span>",
                "<span class=\"codeblock\">        // 11. increments details.howManyDKeysSold                                                                                                               </span>",
                "<span class=\"codeblock\">        // 12. decrements details.bidCounter                                                                                                                     </span>",
                "<span class=\"codeblock\">        // 13. if (details.howManyDKeysSold == details.howManyDKeysForSale), emits DkeysCanBeSold(_ipfsCid)                                                      </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                            </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">function sellDkey(bytes calldata _ipfsCid, uint _sellerPubKeyX, uint[2] calldata _pA, uint[2][2] calldata _pB, uint[2] calldata _pC, uint[7] calldata _pubSignals) external {         </span>",
                "<span class=\"codeblock\">        // 1. grabs the listing details                                                                                                                          </span>",
                "<span class=\"codeblock\">        // 2. requires that thisListing.details.canDkeysBeSold == true                                                                                              </span>",
                "<span class=\"codeblock\">        // 3. grabs the seller's bid                                                                                                                            </span>",
                "<span class=\"codeblock\">        // 4. requires that the seller's bid (i) eth address matches msg.sender, and (ii) shows that seller does in fact own a dkey                             </span>",
                "<span class=\"codeblock\">        // 5. grabs the bidder's bid                                                                                                                            </span>",
                "<span class=\"codeblock\">        // 6. requires that the bidder's bid is open                                                                                                              </span>",
                "<span class=\"codeblock\">        // 7. requires that _pubSignals[4] matches the poseidonHashedSecretKey for this listing                                                                  </span>",
                "<span class=\"codeblock\">        // 8. requires that zkVerifier.verifyProof(_pA, _pB, _pC, _pubSignals) returns true                                                                      </span>",
                "<span class=\"codeblock\">        // 9. emits DKeyProvided(_ipfsCid, _pubSignals[5], [_pubSignals[0], _pubSignals[1], _pubSignals[2], _pubSignals[3]])                                    </span>",
                "<span class=\"codeblock\">        // 10. shows that the bidder now owns a dkey (i.e.: thisListing.xAndYToBid[_pubSignals[5]][_pubSignals[6]].amount = type(uint96).max)                                       </span>",
                "<span class=\"codeblock\">        // 11. shows that the seller no longer owns a dkey (i.e.: delete thisListing.xAndYToBid[_sellerPubKey[0]][_sellerPubKey[1]])                                                </span>",
                "<span class=\"codeblock\">        // 12. transfers the listing owner their royalty (deducted from the bid amount)                                                                          </span>",
                "<span class=\"codeblock\">        // 13. transfers 1% of the bid amount to the DividendPayingToken.sol contract                                                                            </span>",
                "<span class=\"codeblock\">        // 14. transfers the remainder of the bid amount to the seller                                                                                     </span>",
                "<span class=\"codeblock\">        // 15. increments details.howManyDKeysSold                                                                                                               </span>",
                "<span class=\"codeblock\">        // 16. decrements details.bidCounter                                                                                                                     </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                            </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">event ListingCreated(bytes ipfsCid, uint royaltyPercentage, uint howManyDKeysForSale);                               </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">event BidReceived(bytes ipfsCid, uint bidCounter, uint[2] bidderPubKey, uint bidAmount);                              </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">event BidUpdated(bytes ipfsCid, uint bidderPubKeyX, uint updatedBidAmount);                                          </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">event BidReclaimed(bytes ipfsCid, uint bidderPubKeyX);                                                               </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">event DkeyProvided(bytes ipfsCid, uint indexed dkeyOwnerPubKeyX, uint[4] dKey);                                      </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">event DkeysCanBeSold(bytes ipfsCid);                                                                                 </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">struct ListingDetails {                                                                                                                                                   </span>",
                "<span class=\"codeblock\">        address payable listingOwnerAddress;                                                                                                                               </span>",
                "<span class=\"codeblock\">        uint32 bidCounter;                                                                                                                                                </span>",
                "<span class=\"codeblock\">        uint16 howManyDKeysForSale;                                                                                                                                       </span>",
                "<span class=\"codeblock\">        uint16 howManyDKeysSold;                                                                                                                                          </span>",
                "<span class=\"codeblock\">        uint8 royaltyPercentage;                                                                                                                                           </span>",
                "<span class=\"codeblock\">        bool canDkeysBeSold;                                                                                                                                                </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                                      </span>",
                "<br>",
                ],  

                [
                "<br>",
                "<span class=\"codeblock\">struct Listing {                                                                                                                                                         </span>",
                "<span class=\"codeblock\">        uint poseidonHashedSecretKey;                                                                                                                                     </span>",
                "<span class=\"codeblock\">        ListingDetails details;                                                                                                                                          </span>",
                "<span class=\"codeblock\">        mapping(uint => mapping(uint => Bid)) xAndYToBid;                                                                                                                                     </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                                       </span>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">struct Bid {                                                                                                                                                              </span>",
                "<span class=\"codeblock\">        address payable ethAddress;                                                                                                                                       </span>",
                "<span class=\"codeblock\">        uint96 amount;                                                                                                                                                    </span>",
                "<span class=\"codeblock\">    }                                                                                                                                                                      </span>",
                "<br>",
                "NB: <span class=\"codeblock\">amount</span> is used to track if a bid is:",
                "-   'open'                      <span class=\"codeblock\">0 < amount < type(uint96).max</span>",
                "-   'filled'                    <span class=\"codeblock\">amount == type(uint96).max</span>",
                "-   'reclaimed' or deleted      <span class=\"codeblock\">amount == 0</span>",
                "<br>",
                "I.e.: if <span class=\"codeblock\">allListings[ipfsCID].xAndYToBid[pubKeyX][pubKeyY].amount == type(uint96).max</span>, then <span class=\"codeblock\">allListings[ipfsCID].xAndYToBid[pubKeyX][pubKeyY].ethAddress</span> owns a DKEY.",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">mapping(bytes => Listing) allListings;                                                                 </span>",
                "<br>",
                "References all <span class=\"codeblock\">Listing</span> structs by their <span class=\"codeblock\">ipfsCID</span> (i.e.: <span class=\"codeblock\">allListings[ipfsCID]</span>)",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"codeblock\">mapping(uint => mapping(uint => Bid)) xAndYToBid;                                                                 </span>",
                "<br>",
                "References all of a LISTING's <span class=\"codeblock\">Bid</span> structs by their <span class=\"codeblock\">pubKeyX</span> and <span class=\"codeblock\">pubKeyY</span> values (i.e.: <span class=\"codeblock\">allListings[ipfsCID].xAndYToBid[pubKeyX][pubKeyY]</span>)",
                "<br>",
                ],
                
            ],

            lib: [
                [
                "<span class=\"green flush-left underlined\">TECHNICAL DETAILS [3/4]:  THE LIBRARY</span>",
                "<br>",
                "The <span class=\"index\">dkey-sdk</span> typescript library allows front-end applications to interact with the DKEY protocol. It handles User Data (formatting, ",
                'storing, structuring), Blockchain Interactions (listening for events, making function calls, sending transactions), and',
                'Cryptographic Operations (encryption, decryption, hashing, zk-proof generation).',
                "<br>",
                "This functionality is implemented via the <span class=\"index\">DkeyUserProfile</span> class --it defines the following...",
                "<br>",
                "ATTRIBUTES:              METHODS:",
                '>  <a href="lib-1" class="protocol-link no-click">userInfo</a>              >  <a href="lib-7" class="protocol-link no-click">createListing()</a>',
                '>  <a href="lib-2" class="protocol-link no-click">addresses</a>             >  <a href="lib-8" class="protocol-link no-click">makeBid()</a>',
                '>  <a href="lib-3" class="protocol-link no-click">myListings</a>            >  <a href="lib-9" class="protocol-link no-click">fillBid()</a>',
                '>  <a href="lib-4" class="protocol-link no-click">myDKeys</a>               >  <a href="lib-10" class="protocol-link no-click">sellDkey()</a>',
                '>  <a href="lib-5" class="protocol-link no-click">myOpenBids</a>            >  <a href="lib-11" class="protocol-link no-click">reclaimBid()</a>',
                '>  <a href="lib-6" class="protocol-link no-click">config</a>                >  <a href="lib-12" class="protocol-link no-click">updateBid()</a>',
                '                         >  <a href="lib-13" class="protocol-link no-click">checkIfDKeysCanBeSold()</a>',
                '                         >  <a href="lib-14" class="protocol-link no-click">checkIfDKeysReceived()</a>',
                '                         >  <a href="lib-15" class="protocol-link no-click">dkeyReceived()</a>',
                '                         >  <a href="lib-16" class="protocol-link no-click">toEncryptedProfileData()</a>',
                '                         >  <a href="lib-17" class="protocol-link no-click">fromEncryptedProfileData()</a>',
                "<br>",
                "Use the <span class=\"command\">[UP]</span> and <span class=\"command\">[DOWN]</span> arrows to navigate. Hit <span class=\"command\">[BACKSPACE]</span> to go back. Hit <span class=\"command\">[ENTER]</span> to continue.",
                "<br>",
                ],
                
                [
                `<span class="codeblock">userInfo: Record&lt;string, any&gt;</span>`,
                "<br>",
                "Stores user info (e.g. fid, fname, twitter handle, etc). Each front-end application can choose which fields to include.",
                "<br>",
                ],

                [
                `<span class="codeblock">addresses: Record&lt;number, Address&gt;</span>`,
                "<br>",
                "Stores user addresses by chainId.",
                "<br>",
                "Needed to ensure the same address is used in each blockchain call.",
                "(eg: the address used to create a listing must be the same used to fill bids for that listing)",
                "<br>",
                ],

                [
                `<span class="codeblock">myListings: Record&lt;number, Record&lt;string, Listing&gt;&gt;</span>`,
                "<br>",
                "Stores the user's <span class=\"codeblock\">Listing</span> objects by chainId & ipfsCID, i.e.: <span class=\"codeblock\">myListings[chainId][ipfsCID]</span>",
                "<br>",
                "A <span class=\"codeblock\">Listing</span> class object has the following attributes:",
                "•  ipfsCID, metadata, fileSecretKey, howManyDKeysForSale, royaltyPercentage, howManyDKeysSold, canDkeysBeSold, pksThatHaveReceivedDkeys",
                "<br>",
                ],

                [
                `<span class="codeblock">myDKeys: Record&lt;number, Record&lt;string, DKey&gt;&gt;</span>`,
                "<br>",
                "Stores the user's <span class=\"codeblock\">DKey</span> objects by chainId & ipfsCID, i.e.: <span class=\"codeblock\">myDKeys[chainId][ipfsCID]</span>",
                "<br>",
                "A <span class=\"codeblock\">DKey</span> class object has the following attributes:",
                "•  ipfsCID, ownerAddress, pubKeyX, fileSecretKey, chainId, fileName, canSell",
                "<br>",
                ],

                [
                `<span class="codeblock">myOpenBids: Record&lt;number, Record&lt;string, Bid&gt;&gt;</span>`,
                "<br>",
                "Stores the user's <span class=\"codeblock\">Bid</span> objects by chainId & ipfsCID, i.e.: <span class=\"codeblock\">myOpenBids[chainId][ipfsCID]</span>",
                "<br>",
                "A <span class=\"codeblock\">Bid</span> class object has the following attributes:",
                "•  ipfsCID, bidAmountInEth, bidderAddress, pubKeyX, pubKeyY, secretKey, chainId, fileName, isFilled, canSell",
                "<br>",
                ],

                [
                `<span class="codeblock">private config: any</span>`,
                "<br>",
                "Per-session storage of the front-end's wagmi config. Requires that each front-end passes in its own connectors/RPC URLs.",
                "<br>",
                ],

                [
                `<span class="codeblock">createListing(ipfsCID, metadata, fileSecretKey, howManyDKeysForSale, royaltyPercentage, address)</span>`,
                "<br>",
                "Creates a new listing on the blockchain. i.e.:",
                "1.  ensures the connected address is saved to this.addresses",
                "2.  formats the ipfsCID & poseidon hashes the fileSecretKey",
                "3.  calls DKeyStore.sol's createListing()",
                "4.  upon a successful transaction, saves the new listing to myListings[chainId][ipfsCID]",
                "<br>",
                ],

                [
                `<span class="codeblock">makeBid(ipfsCID, bidAmountInEth, metadata, address, chainId, canSell)</span>`,
                "<br>",
                "Submits a bid to a listing on the blockchain. i.e.:",
                "1.  ensures the user is connected to the correct address for the current chain",
                "2.  creates a new BN254 key pair (secretKey, pubKeyX, pubKeyY)",
                "3.  formats args",
                "4.  calls DKeyStore.sol's makeBid()",
                "5.  upon a successful transaction, saves the new bid to myOpenBids[chainId][ipfsCID]",
                "<br>",
                ],

                [
                `<span class="codeblock">fillBid(ipfsCID, bidderPubKeyX, bidderPubKeyY, chainId)</span>`,
                "<br>",
                "The listing owner fills a bid on the blockchain. i.e.:",
                "1.  uses the fileSecretKey+bidderPubKey to generate the dkey+zero-knowledge proof",
                "2.  formats arguments",
                "3.  calls DKeyStore.sol's fillBid()",
                "4.  upon a successful transaction, updates the Listing to show bidderPubKeyX has been provided a dkey",
                "<br>",
                ],

                [
                `<span class="codeblock">sellDkey(ipfsCID, bidderPubKeyX, bidderPubKeyY, chainId)</span>`,
                "<br>",
                "A dkey owner sells their dkey to a bidder on the blockchain. i.e.:",
                "1.  uses the fileSecretKey+bidderPubKey to generate the dkey+zero-knowledge proof",
                "2.  formats arguments",
                "3.  calls DKeyStore.sol's sellDkey()",
                "4.  upon a successful transaction, deletes this.myDKeys[chainId][ipfsCID]",
                "<br>",
                ],

                [
                `<span class="codeblock">reclaimBid(ipfsCID, chainId)</span>`,
                "<br>",
                "The user reclaims their open bid on the blockchain. i.e.:",
                "1.  calls DKeyStore.sol's reclaimBid()",
                "2.  upon a successful transaction, deletes this.myOpenBids[chainId][ipfsCID]",
                "<br>",
                ],

                [
                `<span class="codeblock">updateBid(ipfsCID, chainId, increaseBidAmountInEth)</span>`,
                "<br>",
                "The user increases the amount of their open bid on the blockchain. i.e.:",
                "1.  formats arguments",
                "2.  calls DKeyStore.sol's updateBid()",
                "3.  upon a successful transaction, calls this.myOpenBids[chainId][ipfsCID].increaseBidAmount(increaseBidAmountInEth)",
                "<br>",
                ],

                [
                `<span class="codeblock">checkIfDKeysCanBeSold(chainId)</span>`,
                "<br>",
                "Checks the blockchain to see if the user's dkeys can now be re-sold. i.e.:",
                "1.  prepares the array of listing ipfsCIDs to be checked",
                "2.  calls DKeyStore.sol's batchCheckIfDkeysCanBeSold()",
                "3.  updates this.myDKeys[chainId][ipfsCID].canSell as appropriate",
                "<br>",
                ],

                [
                `<span class="codeblock">checkIfDKeysReceived(chainId)</span>`,
                "<br>",
                "Checks the blockchain to see if any of the user's bids have been filled. i.e.:",
                "1.  prepares the array of ipfsCIDs+pubKeyXs to be checked",
                "2.  calls DKeyStore.sol's batchGetBidStatuses()",
                "3.  updates this.myDKeys[chainId][ipfsCID].isFilled as appropriate",
                "<br>",            
                "(Once seeing that a bid has been filled, the front-end will listen for DkeyProvided events and fetch the dKey[4] values)",
                "<br>",
                ],

                [
                `<span class="codeblock">dkeyReceived(chainId, ipfsCID, dKey[4])</span>`,
                "<br>",
                "After a dkey is fetched from the blockchain, the user deletes their Bid object and creates a new Dkey object. i.e.:",
                "1.  converts dKey[4] into its eM and ke elliptic curve points (i.e.: the elgamal ciphertext)",
                "2.  el gamal decrypts the ciphertext (using myOpenBids[chainId][ipfsCID].secretKey)",
                "3.  creates & saves a new DKey to this.myDKeys[chainId][ipfsCID]",
                "4.  deletes this.myOpenBids[chainId][ipfsCID]",
                "<br>",
                ],

                [
                `<span class="codeblock">toEncryptedProfileData(password)</span>`,
                "<br>",
                "Serializes and encrypts the user's DkeyUserProfile object using the password.",
                "Used by the front-end to save the user's password-protected profile data.",
                "<br>",
                ],

                [
                `<span class="codeblock">fromEncryptedProfileData(encryptedProfileData, password)</span>`,
                "<br>",
                "Decrypts and deserializes the user's DkeyUserProfile object.",
                "<br>",
                ],
            ],

            protocol: [
                [
                "<span class=\"green flush-left underlined\">TECHNICAL DETAILS [4/4]:  THE PROTOCOL</span>",
                "<br>",
                "In summary...",
                "<br>",
                "The SMART CONTRACTs store the data & define the rules necessary to run the protocol: ",
                '     <span class="index">DKeyStore.sol</span>                  Implements the "application logic"',
                '     <span class="index">DividendPayingToken.sol</span>        Implements the $DKEY token',
                '     <span class="index">Verifier.sol</span>                   Handles on-chain verification of zero-knowledge proofs',
                "<br>",
                "The LIBRARY is used by front-end applications to handle: ",
                '     <span class="index">User Data</span>                      (formatting, storing, structuring)',
                '     <span class="index">Blockchain Interactions</span>        (listening for events, making function calls, sending transactions)',
                '     <span class="index">Cryptographic Operations</span>       (encryption, decryption, hashing, zk-proof generation)',
                "<br>",
                "Together, the SMART CONTRACTs + LIBRARY allow for...",
                '>  <a href="protocol-1" class="protocol-link no-click">KEY GENERATION & FILE ENCRYPTION</a>',
                '>  <a href="protocol-2" class="protocol-link no-click">FILE+METADATA UPLOAD</a>',
                '>  <a href="protocol-3" class="protocol-link no-click">LISTING CREATION</a>',
                '>  <a href="protocol-4" class="protocol-link no-click">VIEWING A LISTING</a>',
                '>  <a href="protocol-5" class="protocol-link no-click">PLACING A BID</a>',
                '>  <a href="protocol-6" class="protocol-link no-click">FINDING AN OPEN BID</a>',
                '>  <a href="protocol-7" class="protocol-link no-click">FILLING A BID</a>',
                '>  <a href="protocol-8" class="protocol-link no-click">DECRYPTING THE FILE</a>',
                '>  <a href="protocol-9" class="protocol-link no-click">RE-SELLING A DKEY</a>',
                '>  <a href="protocol-10" class="protocol-link no-click">RECLAIMING A BID</a>',
                '>  <a href="protocol-11" class="protocol-link no-click">UPDATING A BID</a>',
                "<br>",
                "Use the <span class=\"command\">[UP]</span> and <span class=\"command\">[DOWN]</span> arrows to navigate. Hit <span class=\"command\">[BACKSPACE]</span> to go back. Hit <span class=\"command\">[ENTER]</span> to return to the top.",
                "<br>",
                "<span",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">KEY GENERATION & FILE ENCRYPTION:</span>",
                "•  ALICE generates a random point on the <a href=\"https://hackmd.io/@jpw/bn254\" target=\"_blank\">BN254 elliptic curve</a>",
                "•  She concatinates the x&y coordinates of the point (& performs a key derivation function) to form a <span class=\"codeblock\">fileSecretKey</span>",
                "•  She then uses the <span class=\"codeblock\">fileSecretKey</span> to symmetrically encrypt the file she wishes to sell",
                '   (\'dkey-sdk\' currently implements AES-CBC --but most symmetric encryption algorithms will work here) ',
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">FILE+METADATA UPLOAD:</span>",
                "•  ALICE generates a new <span class=\"codeblock\">ListingMetadata</span> class object ('metadata.json'). It contains the following details:",
                '       - <span class="codeblock">seller</span>                     An object that contains fields like fid, fname, twitterUrl, etc',
                '       - <span class="codeblock">fileName</span>                   A string that has the file name and extension',
                '       - <span class="codeblock">fileDescription</span>            A string that includes a description of the file',
                '       - <span class="codeblock">suggestedPriceInEth</span>        A number that ALICE suggests BIDs to be priced at',
                '       - <span class="codeblock">coverPhotoCID</span>              A string that has the IPFS CID of the file\'s cover photo',
                '       - <span class="codeblock">coverPhotoLink</span>             A string that has an IPFS gateway link to the file\'s cover photo',
                '       - <span class="codeblock">chainIds</span>                   An array of the different blockchain chain IDs that the LISTING will be deployed to',
                "•  She adds both the 'metadata.json' and 'encrypted_file.enc' to a directory",
                "•  She pins the directory to IPFS; the resulting IPFS CID will serve as the file's reference",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">LISTING CREATION:</span>",
                "•  ALICE calls the <span class=\"codeblock\">createListing()</span> function on the SMART CONTRACT ('DKeySore.sol'). Her",
                "   transaction includes the following arguments:",
                "       - <span class=\"codeblock\">_ipfsCid</span>                   The 32 byte hash digest of the file's IPFS CID",
                "       - <span class=\"codeblock\">_howManyDKeysForSale</span>       The max number of DKEYs ALICE can sell before only re-selling is permitted",
                "       - <span class=\"codeblock\">_royaltyPercentage</span>         The percentage that ALICE will receive as a royalty on all re-sales",
                "       - <span class=\"codeblock\">_poseidonHashedSecretKey</span>   The poseidon hash commitment of the <span class=\"codeblock\">fileSecretKey</span>",
                "•  A new LISTING struct is created that contains the arguments above, as well as:",
                "       - <span class=\"codeblock\">listingOwnerAddress</span>        ALICE's blockchain address",
                "       - <span class=\"codeblock\">bidCounter</span>                 A uint32 that tracks how many 'open' BIDs there are",
                "       - <span class=\"codeblock\">howManyDKeysSold</span>           A uint16 that tracks how many DKEYs are in circulation",
                "       - <span class=\"codeblock\">canDkeysBeSold</span>             A boolean that is true if <span class=\"codeblock\">howManyDKeysForSale == howManyDKeysSold</span>",
                "•  The SMART CONTRACT saves the struct to the <span class=\"codeblock\">allListings</span> mapping, and a <span class=\"codeblock\">ListingCreated</span> event is emitted",
                "•  A new <span class=\"codeblock\">Listing</span> object is saved to ALICE's <span class=\"codeblock\">DkeyUserProfile</span>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">VIEWING A LISTING:</span>", 
                "•  ALICE shares her file's IPFS CID string with anyone interested in placing a BID. This can take the form of",
                "   a URL (eg: 'example.com/cid=bafyieac...') --but only the IPFS CID is required to view a LISTING.",
                "•  The front-end fetches the LISTING data in two steps:",
                "       -  The less-sensitive data is fetched from IPFS ('metadata.json')",
                "       -  The more-sensitive data is fetched from the SMART CONTRACT (by calling <span class=\"codeblock\">getListingDetails()</span>)",
                "•  The front-end shows as much LISTING data as it chooses --but it should display at a minimum:",
                "       -  <span class=\"codeblock\">howManyDkeysForSale</span>",
                "       -  <span class=\"codeblock\">howManyDkeysSold</span>",
                "       -  <span class=\"codeblock\">royaltyPercentage</span>",
                "       -  <span class=\"codeblock\">bidCounter</span>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">PLACING A BID:</span>",
                "•  BOB generates a public-private key pair (the <span class=\"codeblock\">[pk_x,pk_y,sk]</span> of a point on the BN254 elliptic curve)",
                "•  He verifies that the ENCRYPTED FILE is available on IPFS (and optionally downloads it)",
                "•  He calls the SMART CONTRACT's <span class=\"codeblock\">makeBid()</span> function. The transaction contains the following arguments:",
                "       - <span class=\"codeblock\">_ipfsCid</span>                   The 32 byte hash digest from the file's IPFS CID",
                "       - <span class=\"codeblock\">_bidderPubKey</span>              The public key x&y coordinates",
                "       - <span class=\"codeblock\">msg.value</span>                  The value of the BID",
                "•  The SMART CONTRACT creates a new BID struct with the following fields:",
                "       - <span class=\"codeblock\">amount</span>                     A uint96 that tracks the value of the BID",
                "       - <span class=\"codeblock\">address</span>                    BOB's blockchain address",
                "•  The SMART CONTRACT adds the new BID to the <span class=\"codeblock\">xAndYToBid</span> mapping, and a <span class=\"codeblock\">BidReceived</span> event is emitted",
                "•  A new <span class=\"codeblock\">Bid</span> object is saved to BOB's <span class=\"codeblock\">DkeyUserProfile</span>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">FINDING AN OPEN BID:</span>",
                "•  ALICE finds BIDs by listening for <span class=\"codeblock\">BidReceived</span> (and <span class=\"codeblock\">BidUpdated</span>) events on the blockchain (or by querying a <a href=\"https://thegraph.com/\" target=\"_blank\">subgraph</a>)",
                "•  When she finds a BID, she verifies that it is 'open' (not reclaimed, or already filled) by either: ",
                "       -  calling <span class=\"codeblock\">getBidDetails(_ipfsCid, _bidderPubKeyX)</span> on the SMART CONTRACT, or",
                "       -  checking that the BID's public key is not present in any <span class=\"codeblock\">BidReclaimed</span> or <span class=\"codeblock\">DkeyReceived</span> events",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">FILLING A BID:</span>",
                "•  ALICE fills a BID by calling the SMART CONTRACT's <span class=\"codeblock\">fillBid()</span> function. The transaction contains the following arguments:",
                "       - <span class=\"codeblock\">_ipfsCid</span>                   The 32 byte hash digest from the file's IPFS CID",
                "       - <span class=\"codeblock\">_pA, _pB, _pC</span>              The <a href=\"https://docs.circom.io/getting-started/proving-circuits/#verifying-from-a-smart-contract\" target=\"_blank\">zk proof</a> calldata",
                "       - <span class=\"codeblock\">_pubSignals</span>                A uint[7] array containing the DKEY components, the poseidon hash of the secret key,",
                "                                     and the bidder's public key",
                "•  The SMART CONTRACT verifies that:",
                "       -  the BID being filled is open",
                "       -  ALICE has not yet sold her max number of DKEYs for this LISTING (i.e.: <span class=\"codeblock\">howManyDKeysSold</span> < <span class=\"codeblock\">howManyDKeysForSale</span>)",
                "       -  <span class=\"codeblock\">_pubSignals[4]</span> matches the LISTING's <span class=\"codeblock\">poseidonHashedSecretKey</span>",
                "       -  <span class=\"codeblock\">_pubSignals[5,6]</span> match the public key BOB used in his BID",
                "       -  the zk proof is correct (i.e.: <span class=\"codeblock\">_pubSignals[0,1,2,3]</span> is a valid ciphertext resulting from the <a href=\"https://www.geeksforgeeks.org/elgamal-encryption-algorithm/\" target=\"_blank\">ElGamal</a>", 
                "          encryption of the secret key for BOB's public key)", 
                "•  If all conditions are met, the SMART CONTRACT will:",
                "       -  send 99% of the BID amount to ALICE",
                "       -  send 1% of the BID amount to the <a href=\"https://github.com/Roger-Wu/erc1726-dividend-paying-token\" target=\"_blank\">DividendPayingToken.sol</a> contract",
                "       -  update BOB's BID to show that he now owns a DKEY (i.e.: set <span class=\"codeblock\">xAndYToBid[pk_x][pk_y].amount</span> to <span class=\"codeblock\">type(uint96).max</span>)",
                "       -  increment the LISTING's <span class=\"codeblock\">howManyDKeysSold</span> counter",
                "       -  emit a <span class=\"codeblock\">DkeyProvided</span> event",
                "•  ALICE's <span class=\"codeblock\">DkeyUserProfile</span> is updated, i.e.: <span class=\"codeblock\">this.myListings[chainId][ipfsCID].dkeyProvidedTo(bidderPubKey)</span>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">DECRYPTING THE FILE:</span>",
                "•  BOB listens for <span class=\"codeblock\">DkeyProvided</span> events, and grabs his DKEY",
                "•  He uses his <span class=\"codeblock\">sk</span> to derive ALICE's original <span class=\"codeblock\">fileSecretKey</span> from the DKEY",
                "       (i.e.: BOB uses <span class=\"codeblock\">elGamalDecrypt(bob_sk, dkey)</span> to get ALICE's original BN254 point, which he concatinates ",
                "       and uses in the key derivation function to get the <span class=\"codeblock\">fileSecretKey</span>)",
                "•  He then uses <span class=\"codeblock\">fileSecretKey</span> to decrypt ALICE's file",
                "•  BOB's <span class=\"codeblock\">DkeyUserProfile</span> is updated (i.e.: the <span class=\"codeblock\">Bid</span> object is deleted, and a new <span class=\"codeblock\">DKey</span> object is created)",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">RE-SELLING A DKEY:</span>",
                "Now that BOB has the <span class=\"codeblock\">fileSecretKey</span>, and is listed on the blockchain as a DKEY owner, he can sell his DKEY to CHARLIE...",
                "•  BOB fills CHARLIE's BID by calling the SMART CONTRACT's <span class=\"codeblock\">sellDkey()</span> function. The transaction contains the following arguments:",
                "       - <span class=\"codeblock\">_ipfsCid</span>                   The 32 byte hash digest from the file's IPFS CID",
                "       - <span class=\"codeblock\">_sellerPubKeyX</span>             BOB's public key x-coordinate",
                "       - <span class=\"codeblock\">_pA, _pB, _pC</span>              The <a href=\"https://docs.circom.io/getting-started/proving-circuits/#verifying-from-a-smart-contract\" target=\"_blank\">zk proof</a> calldata",
                "       - <span class=\"codeblock\">_pubSignals</span>                A uint[7] array containing the DKEY components, the poseidon hash of the secret key,",
                "                                     and CHARLIE's public key",
                "•  The SMART CONTRACT verifies that:",
                "       -  canDkeysBeSold is currently <span class=\"codeblock\">true</span> for this LISTING",
                "       -  CHARLIE's BID is currently open",
                "       -  BOB owns a DKEY for this LISTING (<span class=\"codeblock\">xAndYToBid[bob_pk_x][bob_pk_y].amount == type(uint96).max</span> && <span class=\"codeblock\">xAndYToBid[bob_pk_x][bob_pk_y].address == msg.sender</span>)",
                "       -  <span class=\"codeblock\">_pubSignals[4]</span> matches the LISTING's <span class=\"codeblock\">poseidonHashedSecretKey</span>",
                "       -  <span class=\"codeblock\">_pubSignals[5,6]</span> match the public key CHARLIE used in his BID",
                "       -  the zk proof is correct (i.e.: <span class=\"codeblock\">_pubSignals[0,1,2,3]</span> is a valid ciphertext resulting from the <a href=\"https://www.geeksforgeeks.org/elgamal-encryption-algorithm/\" target=\"_blank\">ElGamal</a>", 
                "          encryption of the secret key for CHARLIE's public key)", 
                "•  If all conditions are met, the SMART CONTRACT will:",
                "       -  deduct <span class=\"codeblock\">royaltyPercentage</span> from CHARLIE's BID amount, and send it to ALICE",
                "       -  send 1% of CHARLIE's BID amount to the DividendPayingToken.sol contract",
                "       -  send the remainder of CHARLIE's BID amount to BOB",
                "       -  update BOB's BID to show that he no longer owns a DKEY (i.e.: <span class=\"codeblock\">delete xAndYToBid[bob_pk_x][bob_pk_y]</span>)",
                "       -  update CHARLIE's BID to show that he now owns a DKEY (i.e.: <span class=\"codeblock\">xAndYToBid[charlie_pk_x][charlie_pk_y].amount = type(uint96).max</span>)",
                "       -  increment the LISTING's <span class=\"codeblock\">howManyDKeysSold</span> counter",
                "       -  emit a <span class=\"codeblock\">DkeyProvided</span> event",
                "•  BOB's <span class=\"codeblock\">DkeyUserProfile</span> is updated (i.e.: <span class=\"codeblock\">delete this.myDKeys[chainId][ipfsCID]</span>)",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">RECLAIMING A BID:</span>",
                "•  BOB calls the SMART CONTRACT's <span class=\"codeblock\">reclaimBid()</span> function. The transaction contains the following arguments:",
                "       - <span class=\"codeblock\">_ipfsCid</span>                   The 32 byte hash digest from the file's IPFS CID",
                "       - <span class=\"codeblock\">_bidderPubKeyX</span>             BOB's public key x-coordinate",
                "•  The SMART CONTRACT verifies:",
                "       -  that the BID exists (i.e.: <span class=\"codeblock\">xAndYToBid[BOB's pk_x][BOB's pk_y].amount != 0</span>)",
                "       -  that the BID has not already been filled (i.e.: <span class=\"codeblock\">xAndYToBid[BOB's pk_x][BOB's pk_y].amount != type(uint96).max</span>)",
                "       -  that BOB is the owner of this BID (i.e.: <span class=\"codeblock\">xAndYToBid[BOB's pk_x][BOB's pk_y].ethAddress == msg.sender</span>)",
                "•  If all conditions are met, the SMART CONTRACT will:",
                "       -  return the BID amount to BOB",
                "       -  delete the bid from the <span class=\"codeblock\">xAndYToBid</span> mapping",
                "       -  emit a <span class=\"codeblock\">BidReclaimed</span> event",
                "•  BOB's <span class=\"codeblock\">DkeyUserProfile</span> is updated (i.e.: <span class=\"codeblock\">delete this.myOpenBids[chainId][ipfsCID]</span>)",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],

                [
                "<br>",
                "<span class=\"color2 underlined\">UPDATING A BID:</span>",
                "•  BOB calls the SMART CONTRACT's <span class=\"codeblock\">updateBid()</span> function. The transaction contains the following arguments:",
                "       - <span class=\"codeblock\">_ipfsCid</span>                   The 32 byte hash digest from the file's IPFS CID",
                "       - <span class=\"codeblock\">_bidderPubKeyX</span>             BOB's public key x-coordinate",
                "       - <span class=\"codeblock\">msg.value</span>                  The amount to increase the BID by",
                "•  The SMART CONTRACT verifies that:",
                "       -  the BID exists (i.e.: <span class=\"codeblock\">xAndYToBid[BOB's pk_x][BOB's pk_y].amount != 0</span>)",
                "       -  the BID has not already been filled (i.e.: <span class=\"codeblock\">xAndYToBid[BOB's pk_x][BOB's pk_y].amount != type(uint96).max</span>)",
                "       -  BOB is the owner of this BID (i.e.: <span class=\"codeblock\">xAndYToBid[BOB's pk_x][BOB's pk_y].ethAddress == msg.sender</span>)",
                "•  If all conditions are met, the SMART CONTRACT will:",
                "       -  add <span class=\"codeblock\">msg.value</span> to <span class=\"codeblock\">xAndYToBid[BOB's pk_x][BOB's pk_y].amount</span>",
                "       -  emit a <span class=\"codeblock\">BidUpdated</span> event",
                "•  BOB's <span class=\"codeblock\">DkeyUserProfile</span> is updated (i.e.: <span class=\"codeblock\">this.myOpenBids[chainId][ipfsCID].increaseBidAmount(amount)</span>)",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                "<br>",
                ],  
            ]
        }
